# 2022ë…„ 11ì›” TIL

## 2022.11.17

### Jest - testing code

ê¼­ TDDë¥¼ í•˜ì§€ ì•Šë”ë¼ë„ í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ ì§œëŠ” ìŠµê´€ì„ ë“¤ì´ëŠ” ê²ƒì´ ì¢‹ë‹¤.  
jestë¥¼ ì‚¬ìš©í•˜ì—¬ ê°„ë‹¨í•˜ê²Œ ìœ ë‹› í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•˜ëŠ” ë°©ë²• ë³µê¸°í•´ë´„.  
Next.js ê³µì‹ ë¬¸ì„œì—ë„ [Testing í•­ëª©](https://nextjs.org/docs/testing#jest-and-react-testing-library)ì´ ìˆë‹¤.

**0. Next.js í”„ë¡œì íŠ¸ì— jest ì„¤ì¹˜í•˜ê¸°**

```
yarn add -D jest jest-environment-jsdom @testing-library/react @testing-library/jest-dom
```

```js
// jest.config.js
const nextJest = require("next/jest");

const createJestConfig = nextJest({
  // Provide the path to your Next.js app to load next.config.js and .env files in your test environment
  dir: "./",
});

// Add any custom config to be passed to Jest
/** @type {import('jest').Config} */
const customJestConfig = {
  // Add more setup options before each test is run
  // setupFilesAfterEnv: ['<rootDir>/jest.setup.js'],
  // if using TypeScript with a baseUrl set to the root directory then you need the below for alias' to work
  moduleDirectories: ["node_modules", "<rootDir>/"],
  testEnvironment: "jest-environment-jsdom",
};

// createJestConfig is exported this way to ensure that next/jest can load the Next.js config which is async
module.exports = createJestConfig(customJestConfig);
```

ê³µì‹ ë¬¸ì„œê°€ ì‹œí‚¤ëŠ” ëŒ€ë¡œ íŒ¨í‚¤ì§€ ì„¤ì¹˜í•˜ê³  jest.config.js íŒŒì¼ ìƒì„± ì™„ë£Œ. eslint pluginì—ë„ `jext/globals`ë¥¼ ì¶”ê°€í•´ì¤¬ë‹¤.

**1. jest - ìœ ë‹› í…ŒìŠ¤íŠ¸ (ë‹¨ìˆœ í•¨ìˆ˜)**

```ts
export const add = (a: number, b: number) => {
  return a + b;
};
```

```ts
import { add } from "../../pages/34-01-jest";

it("ë”í•˜ê¸° ì˜ ë˜ëŠ”ì§€ í…ŒìŠ¤íŠ¸ í•´ë³´ê¸°", () => {
  const result = add(3, 5);
  expect(result).toBe(8);
});
```

**2. jest - ìœ ë‹› í…ŒìŠ¤íŠ¸ (í™”ë©´)**

```ts
export default function JestUnitTestPage() {
  return (
    <>
      <div>ì² ìˆ˜ëŠ” 13ì‚´ ì…ë‹ˆë‹¤.</div>
      ì² ìˆ˜ì˜ ì·¨ë¯¸ ì…ë ¥í•˜ê¸°: <input type="text" />
      <button>ì² ìˆ˜ë‘ ë†€ëŸ¬ê°€ê¸°</button>
    </>
  );
}
```

```ts
import { render, screen } from "@testing-library/react";
import JestUnitTestPage from "../../pages/34-02-jest-unit-test";
import "@testing-library/jest-dom";

it("ë‚´ê°€ ì›í•˜ëŠ”ëŒ€ë¡œ ê·¸ë ¤ì§€ëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸°", () => {
  render(<JestUnitTestPage />);

  const myText1 = screen.getByText("ì² ìˆ˜ëŠ” 13ì‚´ ì…ë‹ˆë‹¤.");
  expect(myText1).toBeInTheDocument(); // renderí•œ ë¬¸ì„œ ì•ˆì— myText1ì´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.

  const myText2 = screen.getByText("ì² ìˆ˜ì˜ ì·¨ë¯¸ ì…ë ¥í•˜ê¸°:");
  expect(myText2).toBeInTheDocument(); // renderí•œ ë¬¸ì„œ ì•ˆì— myText2ì´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.

  const myText3 = screen.getByText("ì² ìˆ˜ë‘ ë†€ëŸ¬ê°€ê¸°");
  expect(myText3).toBeInTheDocument(); // renderí•œ ë¬¸ì„œ ì•ˆì— myText3ì´ ìˆëŠ”ì§€ í™•ì¸í•œë‹¤.
});
```

í™”ë©´ì˜ êµ¬ì¡°ê°€ ë³µì¡í•´ì§€ë©´ ìœ„ì™€ ê°™ì´ ìš”ì†Œë¥¼ í•˜ë‚˜í•˜ë‚˜ ë‹¤ ì‘ì„±í•´ì„œ ë¹„êµí•˜ëŠ” ê²ƒì€ ë¹„íš¨ìœ¨ì ì´ë‹¤. ê·¸ë˜ì„œ í™”ë©´ì´ ì œëŒ€ë¡œ ê·¸ë ¤ì¡ŒëŠ”ì§€ í…ŒìŠ¤íŠ¸í•˜ê¸° ìœ„í•´ì„œëŠ” ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸ë¥¼ ì£¼ë¡œ ì´ìš©í•œë‹¤.

:::tip ì˜ë¬¸  
ê·¸ëŸ°ë° ì‚¬ì‹¤ ì´ëŸ° í…ŒìŠ¤íŠ¸ë¥¼ í•  ì¼ì´ ì–¼ë§ˆë‚˜ ìˆì„ê¹Œ..? ğŸ¤” í™”ë©´ë‹¨ì€ í…ŒìŠ¤íŠ¸ ì½”ë“œë³´ë‹¤ QAì™€ ë””ìì´ë„ˆ&ê¸°íšìì˜ ê²€ìˆ˜ê°€ í•„ìš”í•˜ì§€ ì•Šì„ê¹Œ ê·¸ëŸ° ìƒê°ì´ ë“ ë‹¤. ë­ ê·¸ë˜ë„ ì¼ë‹¨ í•  ì¤„ì€ ì•Œì•„ì•¼ í•˜ë‹ˆê¹Œ..  
:::

**3. jest - ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸**

```ts
export default function JestUnitTestPage() {
  return (
    <>
      <div>ì² ìˆ˜ëŠ” 14ì‚´ ì…ë‹ˆë‹¤.</div>
      ì² ìˆ˜ì˜ ì·¨ë¯¸ ì…ë ¥í•˜ê¸°: <input type="text" />
      <button>ì² ìˆ˜ë‘ ë†€ëŸ¬ê°€ê¸°</button>
    </>
  );
}
```

```ts
import { render } from "@testing-library/react";
import JestUnitTestPage from "../../pages/34-03-jest-unit-test-snapshot";

it("ê¸°ì¡´ ì‚¬ì§„ì´ë‘ ë°”ë€ê²Œ ì—†ëŠ”ì§€ ë¹„êµí•´ë³´ì!! - ìŠ¤ëƒ…ìƒ· í…ŒìŠ¤íŠ¸", () => {
  const result = render(<JestUnitTestPage />);
  expect(result.container).toMatchSnapshot();
});
```

## 2022.11.09

ì§€ì˜¥ì˜ ê°•ì˜ ì´¬ì˜ ì£¼ê°„ì´ ëŒì•„ì™”ë‹¤. ê²Œë‹¤ê°€ ê¹”ë”í•œ í‡´ì‚¬ë¥¼ ìœ„í•œ ì±„ìš© í”„ë¡œì„¸ìŠ¤ ì°¸ì—¬ + ì¸ìˆ˜ì¸ê³„ ì‘ì—… ë•Œë¬¸ì— ëˆˆì½”ëœ° ìƒˆ ì—†ì´ ë°”ì˜ë‹¤. ë¹™ê¸€ë¹™ê¸€ ì •ì‹ ì—†ì´ ëŒì•„ê°€ëŠ” í•˜ë£¨í•˜ë£¨. ğŸ˜µâ€ğŸ’«ğŸ«¤ğŸ˜µâ€ğŸ’«ğŸ˜”ğŸ˜µâ€ğŸ’«ğŸ« ğŸ˜µâ€ğŸ’«ğŸ¤¯ğŸ˜µâ€ğŸ’« ê·¸ë˜ë„ ì‚¬ë‚´ ìŠ¤í„°ë”” ë•ë¶„ì— ê³µë¶€ëŠ” ë©ˆì¶”ì§€ ì•Šê³  ìˆë‹¤. ìš”ì¦˜ì—ëŠ” JS Deep diveë¥¼ ë¹ ë¥´ê²Œ í›‘ìœ¼ë©° JS ì›ë¡ ì— ëŒ€í•œ ì´í•´ë¥¼ ê¸°ì´ˆë¶€í„° ìŒ“ì•„ê°€ëŠ” ì¤‘. í‡´ì‚¬í•˜ë©´ ìŠ¤í„°ë”” ì°¸ì—¬ë¥¼ ëª» í•˜ëŠ”ê²Œ ì œì¼ ì•„ì‰½ë„¤.. í˜¼ìë¼ë„ ëŠ˜ì–´ì§€ì§€ ë§ê³  ê¼­ ì˜¬í•´ ì•ˆì— ì™„ë…í•´ì•¼ì§€.  
[Deep dive ìš”ì•½ ì •ë¦¬ ë°”ë¡œê°€ê¸°](../book-js/js-deepdive.html)

## 2022.11.02

### Mongodb ì„¤ì¹˜ & ì‹¤í–‰

ë„ë¦¬ ì‚¬ìš©ë˜ëŠ” NoSQL DBì¸ MongoDBë¥¼ ì„¤ì¹˜í•˜ê³  ì‹¤í–‰í•´ë´¤ë‹¤.  
ë°ì´í„°ë² ì´ìŠ¤ë¥¼ í™•ì¸í•˜ê¸° ìœ„í•œ guiëŠ” mongo-compassë¥¼ ì‚¬ìš©í–ˆê³ , ODMì€ mongoose ì‚¬ìš©.

- `mongodb-community` : ë¬´ë£Œë²„ì „
- `mongodb-enterprise` : ìœ ë£Œë²„ì „

- **ì„¤ì¹˜ ë°©ë²•**  
  MacOSëŠ” Homebrewë¥¼ ì‚¬ìš©í•´ì„œ MongoDBë¥¼ ê°„ë‹¨í•˜ê²Œ ì„¤ì¹˜í•  ìˆ˜ ìˆë‹¤. [ê³µì‹ ë¬¸ì„œì˜ ì„¤ì¹˜ ê°€ì´ë“œ](https://www.mongodb.com/docs/manual/tutorial/install-mongodb-on-os-x/) ì°¸ê³ .

  ```
  brew tap mongodb/brew
  brew install mongodb-community
  ```

  ì„¤ì¹˜ë¥¼ ì™„ë£Œí•œ ë’¤ `brew list`ë¥¼ ì…ë ¥í•˜ë©´ brewë¥¼ ì´ìš©í•´ ì„¤ì¹˜í•œ íŒ¨í‚¤ì§€ ëª©ë¡ì—ì„œ **mongodb-community, mongodb-database-tools, mongosh** ë¥¼ ì°¾ì•„ë³¼ ìˆ˜ ìˆë‹¤. ì´ ì¤‘ mongoshëŠ” MongoDBì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì‰˜ ê°™ì€ ê²ƒ

- **DB ì‹¤í–‰**  
   mongoDB ì‹¤í–‰ ëª…ë ¹ì–´

  ```
  brew services start mongodb-community
  ```

  MongoDBëŠ” ê¸°ë³¸ì ìœ¼ë¡œ 27017 í¬íŠ¸ì—ì„œ ì‹¤í–‰ëœë‹¤. ì‹¤í–‰ í›„ [mongo-compass](https://www.mongodb.com/try/download/compass)ë¥¼ ì´ìš©í•´ localhost:27017ì— ì ‘ì†í•˜ë©´ DBë¥¼ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

![221102_1](../../public/221102_1.png)

### Docker-compoaseë¥¼ ì´ìš©í•œ server & mongoDB ë™ì‹œ ì‹¤í–‰

DBì™€ Backendë¥¼ ë¡œì»¬ì—ì„œ ë°”ë¡œ ì‹¤í–‰í•´ë„ ë˜ì§€ë§Œ, ê´€ë¦¬í•˜ê¸° í¸í•˜ë„ë¡ docker-composeë¥¼ ì´ìš©í•´ ë¬¶ì–´ ì‹¤í–‰í•´ë´¤ë‹¤. backend serviceë¥¼ ë‹´ë‹¹í•˜ëŠ” Dockerfile í•˜ë‚˜, DBë¥¼ ë‹´ë‹¹í•˜ëŠ” Dockerfile í•˜ë‚˜ ë§Œë“¤ì–´ì„œ docker-composeë¥¼ ì´ìš©í•´ ì—°ê²°í•´ì„œ ì‹¤í–‰.

```yaml
version: "3.3"

services:
  my_backend:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 4000:4000

  my_database:
    build:
      context: .
      dockerfile: Dockerfile.mongo
    ports:
      - 27017:27017
```

docker-composeê°€ ìˆëŠ” ìœ„ì¹˜ì—ì„œ `docker-compose build`ë¥¼ ì´ìš©í•´ ë¹Œë“œí•˜ê³ , `docker-compose up`ì„ ì´ìš©í•´ ë¹Œë“œí•œ Docker imageë¥¼ ì‹¤í–‰í•˜ë©´ ëœë‹¤.

ê·¸ëŸ°ë° ì§€ê¸ˆ ì†ŒìŠ¤ì½”ë“œì—ì„œ Dockerfile.mongoê°€ í•´ì£¼ëŠ” ì—­í• ì€ ì‚¬ì‹¤ Docker hubì—ì„œ mongodb imageë¥¼ ë¶ˆëŸ¬ì™€ ì‹¤í–‰ì‹œí‚¤ëŠ” ê²ƒ ë°–ì— ì—†ë‹¤. ì¦‰, ë‹¤ìŒê³¼ ê°™ì´ imageë¥¼ ë°”ë¡œ ë¶ˆëŸ¬ì˜¤ëŠ” ë°©ì‹ìœ¼ë¡œ ë³€ê²½í•´ë„ ë¬¸ì œê°€ ì—†ë‹¤.

```yaml
version: "3.3"

services:
  my_backend:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 4000:4000

  my_database:
    image: mongo:latest
    ports:
      - 27017:27017
```

### Mongoose

[Mongoose](https://mongoosejs.com/)ëŠ” Node.jsì™€ MongoDBë¥¼ ìœ„í•œ ODMì´ë‹¤. ODMì´ë€ Object Data Mappingì´ë¼ëŠ” ì˜ë¯¸ë¡œ, RDBì— ORMì´ ìˆë‹¤ë©´ Document ê¸°ë°˜ NoSQLì—ëŠ” ODMì´ ìˆë‹¤ê³  ìƒê°í•˜ë©´ ê°„ë‹¨..

Boardë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ê¸°ë³¸ì´ ë˜ëŠ” Schemaì™€ Modelì„ ë§Œë“¤ì—ˆë‹¤. ê·¸ë¦¬ê³  ê¸°ì¡´ì— ë§Œë“¤ì–´ë‘ì—ˆë˜ express apië“¤ê³¼ ì—°ê²°í•´ë´¤ìŒ..!

```js
// board.model.js
import mongoose from "mongoose";

const boardSchema = new mongoose.Schema({
  writer: String,
  title: String,
  contents: String,
});

export const Board = mongoose.model("Board", boardSchema);
```

```js
// index.js

//...

mongoose.connect("mongodb://my_database:27017/practice");

app.get("/boards", async (req, res) => {
  const boards = await Board.find();
  res.send(boards);
});

app.post("/boards", async (req, res) => {
  const board = new Board({
    writer: req.body.writer,
    title: req.body.title,
    contents: req.body.contents,
  });
  await board.save();
  res.send("ê²Œì‹œë¬¼ ë“±ë¡ì— ì„±ê³µí•˜ì˜€ìŠµë‹ˆë‹¤!!");
});
```

mongooseì—ì„œ ëª¨ë¸ì˜ ìŠ¤í‚¤ë§ˆë¥¼ ì •ì˜í•  ë•Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” íƒ€ì…, ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ì†Œë“œ ë“±ì€ [ê³µì‹ ë¬¸ì„œ](https://mongoosejs.com/docs/guide.html)ë¥¼ í†µí•´ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```js
// ì—°ìŠµí•˜ë©° ì‚¬ìš©í•´ ë³¸ mongoose ë©”ì†Œë“œë“¤
find();
findOne();
save();
updateOne();
deleteOne();
```

![221102_2](../../public/221102_2.png)  
![221102_4](../../public/221102_3.png)

Docker-composeë¥¼ ì´ìš©í•´ ì„œë²„ì™€ db ì»¨í…Œì´ë„ˆ ë™ì‹œ ì‹¤í–‰ í›„ API ìš”ì²­ ì„±ê³µ ğŸ˜—ğŸ˜‹

## 2022.11.01

### Docker

ì»¨í…Œì´ë„ˆ ê¸°ë°˜ ì˜¤í”ˆì†ŒìŠ¤ ê°€ìƒí™” í”Œë«í¼.  
ì»¨í…Œì´ë„ˆë€ Host OS ìƒì—ì„œ ë¦¬ì†ŒìŠ¤ë¥¼ ë…¼ë¦¬ì ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ë§ˆì¹˜ ë³„ë„ì˜ ì„œë²„ì¸ ê²ƒì²˜ëŸ¼ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ í•˜ëŠ” ê¸°ìˆ . ì´ ë•Œ, ê°ê°ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë¬¼ë¦¬ì ìœ¼ë¡œ êµ¬ë¶„í•˜ëŠ” ê²ƒì´ ì•„ë‹ˆë¼ ë…¼ë¦¬ì ìœ¼ë¡œ êµ¬ë¶„í•œë‹¤ëŠ” ì ì´ ì¤‘ìš”í•˜ë‹¤. ê·¸ëŸ¬í•œ íŠ¹ì§• ë•Œë¬¸ì— ê¸°ì¡´ì˜ ê°€ìƒí™” ë„êµ¬ë“¤ì— ë¹„í•´ ê°€ë²¼ìš´ ê²ƒ.

dockerëŠ” `Dockerfile`ì„ ì´ìš©í•´ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

1. **Dockerfile ì˜ˆì‹œ**

```docker
FROM node:16

WORKDIR /my_backend/
COPY ./package.json /my_backend/
COPY ./yarn.lock /my_backend/
RUN yarn install

COPY . /my_backend/
CMD node index.js
```

2. **docker ëª…ë ¹ì–´**

| ëª…ë ¹ì–´                       | ë‚´ìš©                         |
| ---------------------------- | ---------------------------- |
| `docker build .`             | ë„ì»¤ ì´ë¯¸ì§€ ë¹Œë“œ             |
| `docker images`              | ë¹Œë“œí•œ ë„ì»¤ ì´ë¯¸ì§€ ëª©ë¡ í™•ì¸ |
| `docker run [IMAGE_ID]`      | ë„ì»¤ ì´ë¯¸ì§€ ì‹¤í–‰             |
| `docker ps`                  | ì‹¤í–‰ì¤‘ì¸ ë„ì»¤ í”„ë¡œì„¸ìŠ¤ í™•ì¸  |
| `docker stop [CONTAINER_ID]` | íŠ¹ì • ì»¨í…Œì´ë„ˆ ì‹¤í–‰ ì¤‘ë‹¨      |

3. **ì‹¤í–‰ì¤‘ì¸ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ì ‘ê·¼**  
   ì´ëŸ¬í•œ ë°©ë²•ì„ ì´ìš©í•´ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ë¡œ ì´ë™í•´ `ls` ëª…ë ¹ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì†ŒìŠ¤ì½”ë“œê°€ ë³µì‚¬ë˜ì–´ ìˆëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

```
docker exec -it [CONTAINER_ID] /bin/bash
```

4. **í¬íŠ¸ í¬ì›Œë”©**  
   ë„ì»¤ ì»¨í…Œì´ë„ˆ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ë˜ê³  ìˆëŠ” í¬íŠ¸ì™€ ë‚´ ì»´í“¨í„°ì˜ í¬íŠ¸ë¥¼ ì—°ê²°í•´ì¤˜ì•¼ ì™¸ë¶€ì—ì„œë„ í•´ë‹¹ í¬íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤. ì´ëŸ¬í•œ ì‘ì—…ì„ í¬íŠ¸ í¬ì›Œë”©ì´ë¼ê³  í•œë‹¤.

```
docker run -p [LOCAL_PORT]:[CONTAINER_PORT] [IMAGE_ID]
docker run -p 1000:4000 b4e6b94936a9
```

5. **ë„ì»¤ ì‹¤í–‰ ëª…ë ¹ì–´ ì˜µì…˜**

| OPTIONS | ì„¤ëª…                                        |
| ------- | ------------------------------------------- |
| `-d`    | ë°±ê·¸ë¼ìš´ë“œ ëª¨ë“œ ì‹¤í–‰ (detached mode)        |
| `-p`    | í¬íŠ¸ í¬ì›Œë”© = í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆì˜ í¬íŠ¸ ì—°ê²° |
| `-v`    | í˜¸ìŠ¤íŠ¸ì™€ ì»¨í…Œì´ë„ˆì˜ ë””ë ‰í† ë¦¬ ì—°ê²°(ë§ˆìš´íŠ¸)   |
| `-e`    | ì»¨í…Œì´ë„ˆ ë‚´ì—ì„œ ì‚¬ìš©í•  í™˜ê²½ë³€ìˆ˜ ì„¤ì •        |
| `-name` | ì»¨í…Œì´ë„ˆ ì´ë¦„ ì„¤ì •                          |
| `-rm`   | í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œì‹œ ì»¨í…Œì´ë„ˆ ìë™ ì œê±°          |
| `-it`   | í„°ë¯¸ë„ ì…ë ¥ ì˜µì…˜                            |
| `-link` | ì»¨í…Œì´ë„ˆ ì—°ê²°                               |

::: tip Ref  
[https://docs.docker.com/engine/reference/commandline/run/](https://docs.docker.com/engine/reference/commandline/run/)  
[https://myjamong.tistory.com/297](https://myjamong.tistory.com/297)  
[https://pearlluck.tistory.com/144](https://pearlluck.tistory.com/144)
:::
